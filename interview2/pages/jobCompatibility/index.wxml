<t-toast id="t-toast" />

<view class="job-compatibility-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="title">
        <t-icon name="chart" size="56rpx" color="#fff" />
        <text>å·¥ä½œé€‚é…åº¦æµ‹è¯„</text>
      </view>
      <view class="subtitle">é€šè¿‡é—®å·äº†è§£æ‚¨çš„æœŸæœ›ï¼ŒAIä¸ºæ‚¨åˆ†æèŒä¸šé€‚é…åº¦</view>
    </view>
    <view class="header-icon">ğŸ“Š</view>
  </view>

  <!-- æµ‹è¯„è¯´æ˜ -->
  <view class="intro-card">
    <view class="intro-title">æµ‹è¯„è¯´æ˜</view>
    <view class="intro-desc">
      æˆ‘ä»¬å°†ä»å·¥èµ„æœŸæœ›ã€å…´è¶£çˆ±å¥½ã€å·¥ä½œç¯å¢ƒåå¥½ã€èŒä¸šå‘å±•ç›®æ ‡ç­‰ç»´åº¦ï¼Œ
      ç»“åˆAIæ™ºèƒ½åˆ†æï¼Œä¸ºæ‚¨åŒ¹é…æœ€é€‚åˆçš„èŒä¸šæ–¹å‘å’Œå²—ä½ã€‚
    </view>
    <view class="features">
      <view class="feature-item">
        <view class="feature-icon">ğŸ’°</view>
        <view class="feature-text">è–ªèµ„æœŸæœ›åˆ†æ</view>
      </view>
      <view class="feature-item">
        <view class="feature-icon">â¤ï¸</view>
        <view class="feature-text">å…´è¶£åŒ¹é…åº¦</view>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸŒŸ</view>
        <view class="feature-text">å‘å±•å‰æ™¯è¯„ä¼°</view>
      </view>
      <view class="feature-item">
        <view class="feature-icon">ğŸ¢</view>
        <view class="feature-text">å·¥ä½œç¯å¢ƒé€‚é…</view>
      </view>
    </view>
  </view>

  <!-- é—®å·åŒºåŸŸ -->
  <view class="questionnaire" wx:if="{{showQuestionnaire}}">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{(currentQuestion + 1) / questions.length * 100}}%"></view>
    </view>
    
    <view class="question-card">
      <view class="question-number">é—®é¢˜ {{currentQuestion + 1}}/{{questions.length}}</view>
      <view class="question-title">{{questions[currentQuestion].title}}</view>
      
      <!-- å•é€‰é¢˜ -->
      <view wx:if="{{questions[currentQuestion].type === 'radio'}}" class="options">
        <view 
          wx:for="{{questions[currentQuestion].options}}" 
          wx:key="value"
          class="option-item {{answers[currentQuestion] === item.value ? 'selected' : ''}}"
          bindtap="selectOption"
          data-value="{{item.value}}"
        >
          <view class="option-radio">
            <view wx:if="{{answers[currentQuestion] === item.value}}" class="radio-checked"></view>
          </view>
          <view class="option-text">{{item.label}}</view>
        </view>
      </view>
      
      <!-- æ»‘å—é¢˜ -->
      <view wx:if="{{questions[currentQuestion].type === 'slider'}}" class="slider-container">
        <view class="slider-labels">
          <view class="slider-label">{{questions[currentQuestion].min_label}}</view>
          <view class="slider-label">{{questions[currentQuestion].max_label}}</view>
        </view>
        <slider 
          class="salary-slider"
          min="{{questions[currentQuestion].min}}"
          max="{{questions[currentQuestion].max}}"
          value="{{answers[currentQuestion] || questions[currentQuestion].default}}"
          step="{{questions[currentQuestion].step || 1}}"
          bindchange="onSliderChange"
          activeColor="#667eea"
          backgroundColor="#e8f0fe"
        />
        <view class="slider-value">{{answers[currentQuestion] || questions[currentQuestion].default}}{{questions[currentQuestion].unit}}</view>
      </view>
      
      <!-- å¤šé€‰é¢˜ -->
      <view wx:if="{{questions[currentQuestion].type === 'checkbox'}}" class="checkbox-options">
        <view 
          wx:for="{{questions[currentQuestion].options}}" 
          wx:key="value"
          class="checkbox-item {{answers[currentQuestion] && answers[currentQuestion].includes(item.value) ? 'selected' : ''}}"
          bindtap="toggleCheckbox"
          data-value="{{item.value}}"
        >
          <view class="checkbox">
            <view wx:if="{{answers[currentQuestion] && answers[currentQuestion].includes(item.value)}}" class="checkbox-checked">âœ“</view>
          </view>
          <view class="checkbox-text">{{item.label}}</view>
        </view>
      </view>
    </view>
    
    <!-- å¯¼èˆªæŒ‰é’® -->
    <view class="nav-buttons">
      <button 
        wx:if="{{currentQuestion > 0}}"
        class="nav-btn prev-btn" 
        bindtap="prevQuestion"
      >
        ä¸Šä¸€é¢˜
      </button>
      <button 
        wx:if="{{currentQuestion < questions.length - 1}}"
        class="nav-btn next-btn {{canProceed ? '' : 'disabled'}}" 
        bindtap="nextQuestion"
        disabled="{{!canProceed}}"
      >
        ä¸‹ä¸€é¢˜
      </button>
      <button 
        wx:if="{{currentQuestion === questions.length - 1}}"
        class="nav-btn submit-btn {{canProceed ? '' : 'disabled'}}" 
        bindtap="submitQuestionnaire"
        disabled="{{!canProceed}}"
        loading="{{submitting}}"
      >
        ç”Ÿæˆé€‚é…åº¦æŠ¥å‘Š
      </button>
    </view>
  </view>

  <!-- å¼€å§‹æµ‹è¯„æŒ‰é’® -->
  <view wx:if="{{!showQuestionnaire && !showResults}}" class="start-section">
    <button class="start-btn" bindtap="startQuestionnaire">
      <view class="btn-content">
        <view class="btn-icon">ğŸš€</view>
        <view class="btn-text">å¼€å§‹æµ‹è¯„</view>
      </view>
    </button>
    <view class="time-tip">é¢„è®¡ç”¨æ—¶ï¼š3-5åˆ†é’Ÿ</view>
  </view>

  <!-- ç»“æœå±•ç¤º -->
  <view wx:if="{{showResults}}" class="results-section">
    <view class="results-header">
      <view class="results-title">æ‚¨çš„é€‚é…åº¦æŠ¥å‘Š</view>
      <view class="overall-score">
        <view class="score-number">{{results.overall_score}}</view>
        <view class="score-text">æ€»ä½“é€‚é…åº¦</view>
      </view>
    </view>
    
    <view class="score-breakdown">
      <view 
        wx:for="{{results.dimensions}}" 
        wx:key="name"
        class="dimension-item"
      >
        <view class="dimension-info">
          <view class="dimension-name">{{item.name}}</view>
          <view class="dimension-score">{{item.score}}%</view>
        </view>
        <view class="dimension-bar">
          <view class="dimension-fill" style="width: {{item.score}}%"></view>
        </view>
      </view>
    </view>
    
    <view class="recommendations">
      <view class="recommendations-title">AIæ¨èå»ºè®®</view>
      <view 
        wx:for="{{results.recommendations}}" 
        wx:key="*this"
        class="recommendation-item"
      >
        {{item}}
      </view>
    </view>
    
    <view class="action-buttons">
      <button class="action-btn secondary" bindtap="restartTest">é‡æ–°æµ‹è¯„</button>
      <button class="action-btn primary" bindtap="shareResults">åˆ†äº«ç»“æœ</button>
    </view>
  </view>
</view>
